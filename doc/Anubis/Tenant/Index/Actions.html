<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Anubis::Tenant::Index::Actions
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Anubis::Tenant::Index::Actions";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Index.html" title="Anubis::Tenant::Index (module)">Index</a></span></span>
     &raquo; 
    <span class="title">Actions</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Anubis::Tenant::Index::Actions
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../../Core/Index/Actions.html" title="Anubis::Core::Index::Actions (module)">Core::Index::Actions</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../IndexController.html" title="Anubis::Tenant::IndexController (class)">Anubis::Tenant::IndexController</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/anoubis/tenant/index/actions.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Module contains all basic actions for <span class='object_link'><a href="../IndexController.html" title="Anubis::Tenant::IndexController (class)">Anubis::Tenant::IndexController</a></span>.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#login-instance_method" title="#login (instance method)">#<strong>login</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p><em>Login</em> action of index controller.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#menu-instance_method" title="#menu (instance method)">#<strong>menu</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p><em>Menu</em> action of index controller.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Core/Index/Actions.html" title="Anubis::Core::Index::Actions (module)">Core::Index::Actions</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Core/Index/Actions.html#logout-instance_method" title="Anubis::Core::Index::Actions#logout (method)">#logout</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="login-instance_method">
  
    #<strong>login</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p><em>Login</em> action of index controller. Procedure checks user credential. If credentials are correct than user enters into the system and procedure returns session token. If credentials are incorrect then procedure returns error.</p>

<p><strong>API request:</strong></p>

<pre class="code ruby"><code class="ruby">POST /api/&lt;version&gt;/login
</code></pre>

<p><strong>Request body:</strong></p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>login</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>login</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>password</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>locale</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Country code</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
</code></pre>

<p><strong>Parameters:</strong></p>
<ul><li>
<p><strong>login</strong> (String) – the login of the user</p>
</li><li>
<p><strong>password</strong> (String) – the password of the user</p>
</li><li>
<p><strong>locale</strong> (String) – the output language locale <em>(optional value)</em></p>
</li></ul>

<p><strong>Request example:</strong></p>

<pre class="code ruby"><code class="ruby">curl --header &quot;Content-Type: application/json&quot; --request POST --data &#39;{&quot;login&quot;:&quot;&lt;login&gt;&quot;,&quot;password&quot;:&quot;&lt;password&gt;&quot;}&#39; http://&lt;server&gt;:&lt;port&gt;/api/&lt;api-version&gt;/login
</code></pre>

<p><strong>Results:</strong><br></p>

<p>Resulting data is placed in self.output(OutputLogin) class and returns in JSON format.</p>

<p><strong>Examples:</strong></p>

<p><strong>Success:</strong> HTTP response code 200</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>result</span><span class='label_end'>&quot;:</span> <span class='int'>0</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Successful</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>surname</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Surname</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>token</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Session token</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>email</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>e-mail</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
</code></pre>

<p><strong>Error:</strong> HTTP response code 422</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>result</span><span class='label_end'>&quot;:</span> <span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Incorrect user login or password</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/anoubis/tenant/index/actions.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_login'>login</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Output.html" title="Anubis::Output (module)">Output</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Output/Login.html" title="Anubis::Output::Login (class)">Login</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Output/Login.html#initialize-instance_method" title="Anubis::Output::Login#initialize (method)">new</a></span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:login</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:password</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../User.html" title="Anubis::Tenant::User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>login:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:login</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_user'>user</span>
      <span class='id identifier rubyid_tenant'>tenant</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'>Tenant</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'>Tenant</span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='lbracket'>[</span><span class='symbol'>:default</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../User.html" title="Anubis::Tenant::User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>login:</span> <span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:login</span><span class='rbracket'>]</span><span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span><span class='op'>+</span><span class='id identifier rubyid_tenant'>tenant</span><span class='period'>.</span><span class='id identifier rubyid_ident'>ident</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_user'>user</span>
      <span class='id identifier rubyid_tenant'>tenant</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'>Tenant</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../User.html" title="Anubis::Tenant::User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>login:</span> <span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:login</span><span class='rbracket'>]</span><span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span><span class='op'>+</span><span class='id identifier rubyid_tenant'>tenant</span><span class='period'>.</span><span class='id identifier rubyid_ident'>ident</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_authenticate'>authenticate</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_auth_key'>auth_key</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_redis_save_user'>redis_save_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='id identifier rubyid_new_session_id'>new_session_id</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_surname'>surname</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_surname'>surname</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_redis'>redis</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_redis_prefix'>redis_prefix</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>session:</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>uuid:</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span> <span class='label'>login:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='comma'>,</span> <span class='label'>time:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='comma'>,</span> <span class='label'>ttl:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_timeout'>timeout</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>2</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>2</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:unprocessable_entity</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="menu-instance_method">
  
    #<strong>menu</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p><em>Menu</em> action of index controller. Procedure outputs menu for current user in JSON format. Authorization bearer is required.</p>

<p><strong>API request:</strong></p>

<pre class="code ruby"><code class="ruby">GET /api/&lt;version&gt;/menu
</code></pre>

<p><strong>Request Header:</strong></p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Authorization</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bearer &lt;Session token&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
</code></pre>

<p><strong>Parameters:</strong></p>
<ul><li>
<p><strong>locale</strong> (String) – the output language locale <em>(optional value)</em></p>
</li></ul>

<p><strong>Request example:</strong></p>

<pre class="code ruby"><code class="ruby">curl --header &quot;Content-Type: application/json&quot; -header &#39;Authorization: Bearer &lt;session-token&gt;&#39; http://&lt;server&gt;:&lt;port&gt;/api/&lt;api-version&gt;/menu?locale=en
</code></pre>

<p><strong>Results:</strong><br></p>

<p>Resulting data is placed in self.output(<span class='object_link'><a href="../../Output/Menu.html" title="Anubis::Output::Menu (class)">Output::Menu</a></span>) variable and returns in JSON format.</p>

<p><strong>Examples:</strong></p>

<p><strong>Success:</strong> HTTP response code 200</p>

<pre class="code ruby"><code class="ruby">{
  &quot;result&quot;: 0,
  &quot;message&quot;: &quot;Successful&quot;,
  &quot;menu&quot;: {
    [{
      &quot;mode&quot;: &quot;admin/anubis&quot;,
      &quot;title&quot;: &quot;Administration&quot;,
      &quot;page_title&quot;: &quot;System administration&quot;,
      &quot;short_title&quot;: &quot;&quot;,
      &quot;position&quot;: 0,
      &quot;tab&quot;: 0,
      &quot;action&quot;: &quot;menu&quot;,
      &quot;access&quot;: &quot;read&quot;,
      &quot;state&quot;: &quot;visible&quot;,
      &quot;parent&quot;: &quot;&quot;
    }]
  }
}
</code></pre>

<p><strong>Error:</strong> HTTP response code 422</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>result</span><span class='label_end'>&quot;:</span> <span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Session expired</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/anoubis/tenant/index/actions.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_menu'>menu</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Output.html" title="Anubis::Output (module)">Output</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Output/Menu.html" title="Anubis::Output::Menu (class)">Menu</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Output/Menu.html#initialize-instance_method" title="Anubis::Output::Menu#initialize (method)">new</a></span></span>
  <span class='id identifier rubyid_access'>access</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'>GroupMenu</span><span class='period'>.</span><span class='id identifier rubyid_accesses'>accesses</span><span class='lbracket'>[</span><span class='symbol'>:read</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='op'>+</span><span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'>GroupMenu</span><span class='period'>.</span><span class='id identifier rubyid_accesses'>accesses</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_locale'>locale</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'>MenuLocale</span><span class='period'>.</span><span class='id identifier rubyid_locales'>locales</span><span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;-SQL</span>
<span class='tstring_content'>  SELECT `t`.* FROM
    (
      SELECT `t2`.`id`, `t2`.`mode`, `t2`.`action`, `t2`.`title`, `t2`.`page_title`, `t2`.`short_title`, 
        `t2`.`position`, `t2`.`tab`, `t2`.`menu_id`, `t2`.`state`, MAX(`t2`.`access`) AS `access`,
        `t2`.`user_id`, `t2`.`parent_mode`
      FROM (
        SELECT `menus`.`id`, `menus`.`mode`, `menus`.`action`, `menu_locales`.`title`, `menu_locales`.`page_title`,
          `menu_locales`.`short_title`, `menus`.`position`, `menus`.`tab`, `menus`.`menu_id`, `menus`.`state`,
          `group_menus`.`access`, `user_groups`.`user_id`, `parent_menu`.`mode` AS `parent_mode`
        FROM (`menus`, `group_menus`, `groups`, `user_groups`)
          LEFT JOIN `menu_locales` ON `menu_locales`.`menu_id` = `menus`.`id` AND `menu_locales`.`locale` = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_locale'>locale</span><span class='embexpr_end'>}</span><span class='tstring_content'>
          LEFT JOIN `menus` AS `parent_menu` ON `menus`.`menu_id` = `parent_menu`.`id`
        WHERE `menus`.`id` = `group_menus`.`menu_id` AND `menus`.`status` = 0 AND `group_menus`.`group_id` = `groups`.`id` AND
          `groups`.`id` = `user_groups`.`group_id` AND `user_groups`.`user_id` = </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>
        ) AS `t2`
       GROUP BY `t2`.`id`, `t2`.`mode`, `t2`.`action`, `t2`.`title`, `t2`.`page_title`, `t2`.`short_title`,
          `t2`.`position`, `t2`.`tab`, `t2`.`menu_id`, `t2`.`state`, `t2`.`user_id`, `t2`.`parent_mode`) AS `t`
       WHERE `t`.access IN (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_access'>access</span><span class='embexpr_end'>}</span><span class='tstring_content'>
    )
  ORDER BY `t`.`menu_id`, `t`.`position`
</span><span class='heredoc_end'>  SQL
</span>  <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'>GroupMenu</span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='op'>|</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_addElement'>addElement</span><span class='lparen'>(</span><span class='lbrace'>{</span>
                             <span class='label'>mode:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span>
                             <span class='label'>title:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span>
                             <span class='label'>page_title:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_page_title'>page_title</span><span class='comma'>,</span>
                             <span class='label'>short_title:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_short_title'>short_title</span><span class='comma'>,</span>
                             <span class='label'>position:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='comma'>,</span>
                             <span class='label'>tab:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_tab'>tab</span><span class='comma'>,</span>
                             <span class='label'>action:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span>
                             <span class='label'>access:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_access'>access</span><span class='comma'>,</span>
                             <span class='label'>state:</span> <span class='const'><span class='object_link'><a href="../../../Anubis.html" title="Anubis (module)">Anubis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Tenant.html" title="Anubis::Tenant (module)">Tenant</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Menu.html" title="Anubis::Tenant::Menu (class)">Menu</a></span></span><span class='period'>.</span><span class='id identifier rubyid_states'>states</span><span class='period'>.</span><span class='id identifier rubyid_invert'>invert</span><span class='lbracket'>[</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span><span class='comma'>,</span>
                             <span class='label'>parent:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_parent_mode'>parent_mode</span>
                           <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='comment'>#self.output[:data].push menu_id[data.id.to_s.to_sym]
</span>  <span class='kw'>end</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_before_menu_output'>before_menu_output</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_around_menu_output'>around_menu_output</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Jan 29 21:53:39 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.7.1).
</div>

    </div>
  </body>
</html>